rules_version = '2';
// ========================================
// STORAGE SECURITY RULES - PLAYAS RD
// ========================================
// Aplicación: Playas RD
// Descripción: Descubre las mejores playas de República Dominicana
// Proyecto: playas-rd-2b475
// Entorno: PRODUCCIÓN
// Fecha: Octubre 2025
// ========================================

service firebase.storage {
  match /b/{bucket}/o {
    
    // Función de ayuda
    function isSignedIn() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    
    function isImage() {
      return request.resource.contentType.matches('image/.*');
    }
    
    // FOTOS DE REPORTES
    // Máximo 5MB por imagen
    match /reports/{userId}/{fileName} {
      allow read: if true;
      allow write: if isSignedIn() && 
        isOwner(userId) &&
        isImage() &&
        request.resource.size < 5 * 1024 * 1024;
    }
    
    // FOTOS DE PERFIL
    // Máximo 2MB por imagen
    match /profiles/{userId}/{fileName} {
      allow read: if true;
      allow write: if isSignedIn() && 
        isOwner(userId) &&
        isImage() &&
        request.resource.size < 2 * 1024 * 1024;
    }
    
    // FOTOS DE PLAYAS (solo usuarios autenticados)
    // Máximo 10MB por imagen
    match /beaches/{beachId}/{fileName} {
      allow read: if true; // Todos pueden ver fotos de playas
      allow write: if isSignedIn() && 
        isImage() &&
        request.resource.size < 10 * 1024 * 1024; // 10MB máximo
    }
    
    // FOTOS DE VISITANTES (feedback de usuarios)
    // Máximo 5MB por imagen
    match /beach_photos/{beachId}/{fileName} {
      allow read: if true;
      allow write: if isSignedIn() && 
        isImage() &&
        request.resource.size < 5 * 1024 * 1024;
    }
  }
}

